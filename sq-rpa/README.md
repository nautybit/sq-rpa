# 松鼠RPA - 微信自动回复机器人

![版本](https://img.shields.io/badge/%E7%89%88%E6%9C%AC-1.0.0-blue)
![平台](https://img.shields.io/badge/%E5%B9%B3%E5%8F%B0-Android-green)
![语言](https://img.shields.io/badge/%E8%AF%AD%E8%A8%80-Kotlin%7CJavaScript-orange)

松鼠RPA是一款基于Android辅助功能服务的自动化工具，可以监听微信消息并通过JavaScript脚本控制自动回复逻辑。无需微信插件和Root权限，轻松实现微信消息的自动化处理。

## 功能特性

- 🔍 **实时监听微信消息**：基于Android辅助功能服务，无需Root权限
- 📝 **强大的脚本控制**：使用JavaScript脚本自定义回复逻辑和行为
- 🔧 **灵活的规则配置**：支持关键词匹配、正则表达式和脚本触发规则
- 💾 **完整的数据记录**：保存所有消息记录，方便回溯和分析
- ⚙️ **简洁的用户界面**：Jetpack Compose构建的现代化界面
- 🔒 **低资源占用**：高效的后台服务，最小化电池和内存消耗
- 🔄 **多平台支持**：设计用于支持多种聊天应用（当前聚焦于微信）
- 🔄 **自适应UI元素识别**：增强的微信元素ID适配能力，支持多种微信版本（包括8.0.42）

## 屏幕截图

> 待添加

## 安装说明

### 系统要求

- Android 7.0 (API 24)或更高版本
- 启用辅助功能服务的权限
- （可选）启用通知权限以支持通知处理

### 安装步骤

1. 下载最新的APK文件
2. 在设备上安装APK
   ```bash
   adb install -r sq-rpa.apk
   ```
3. 打开应用并按照屏幕上的说明启用辅助功能

### 权限说明

本应用需要以下权限：
- **辅助功能服务**：核心功能，用于读取和操作屏幕内容
- **网络访问**：用于API调用和数据处理（如有需要）
- **存储权限**：用于导入导出数据

## 配置指南

### 辅助功能设置

1. 在应用中点击"启用辅助功能"按钮
2. 在系统设置中启用松鼠RPA辅助功能服务
3. 返回应用，确认服务状态显示为"已运行"

### 规则配置

1. 点击"规则管理"
2. 点击"+"按钮添加新规则
3. 填写规则详情：
   - 规则名称: 易于识别的名称
   - 匹配模式: 正则表达式模式
   - 响应类型: 文本回复或脚本
   - 优先级: 1-100（1为最高）
   - 启用状态: 开启/关闭

### 脚本配置

1. 点击"脚本管理"
2. 点击"+"按钮添加新脚本
3. 编写JavaScript脚本处理消息:

```javascript
// 一个简单的脚本示例
function processMessage(message, sender) {
    // 写入日志
    log.info("收到消息: " + message + " 来自: " + sender);
    
    // 返回回复内容
    if (message.includes("你好")) {
        return "你好！我是自动回复机器人。";
    }
    
    return null; // 返回null表示不回复
}
```

## 设备兼容性

松鼠RPA已在多种设备上测试，包括：

- Redmi 9A（MIUI 12, Android 10）
- 小米10（MIUI 13, Android 11）
- 华为P40（EMUI 11, Android 10）
- 三星Galaxy S21（One UI 3.1, Android 11）

### 微信版本兼容性

- 经过优化的核心功能确保对不同微信版本的兼容性
- 特别针对微信8.0.42版本进行了适配和测试
- 采用自适应UI元素识别算法，支持多种ID格式
- 详细的调试指南位于 `app/docs/debugging_guide.md`

## 故障排除

如果应用无法正常工作，请尝试以下解决方案：

1. **服务未启动**
   - 检查辅助功能服务是否已启用
   - 重启设备后可能需要重新启用服务

2. **无法识别消息**
   - 确保应用具有足够权限
   - 检查当前微信版本，参考调试指南进行适配

3. **自动回复失败**
   - 验证您的规则匹配模式是否正确
   - 检查脚本中的语法错误或逻辑问题

4. **数据库错误**
   - 应用现在包含更健壮的数据库错误处理
   - 在极端情况下，可能需要清除应用数据并重新配置

5. **性能问题**
   - 禁用过于复杂的脚本和规则
   - 确保设备电池优化设置不会限制应用后台运行

## JavaScript API参考

### 全局对象

- `log`: 日志记录工具
  - `log.debug(message)`: 记录调试信息
  - `log.info(message)`: 记录信息
  - `log.warn(message)`: 记录警告
  - `log.error(message)`: 记录错误

- `db`: 数据库访问工具
  - `db.get(key)`: 获取存储的值
  - `db.set(key, value)`: 存储键值对
  - `db.remove(key)`: 删除存储的值

### 主要函数

```javascript
/**
 * 处理接收到的消息
 * @param {string} message - 接收到的消息内容
 * @param {string} sender - 发送者标识符
 * @return {string|null} 回复内容或null（不回复）
 */
function processMessage(message, sender) {
    // 实现您的消息处理逻辑
    return "回复内容";
}
```

## 架构概览

松鼠RPA采用分层架构设计，包括：

1. **用户界面层**: 使用Android Jetpack组件构建
2. **业务逻辑层**: 包含规则和脚本处理功能
3. **服务层**: 实现辅助功能服务和核心自动化功能
4. **数据层**: 使用Room持久化数据

详细架构说明可在 `app/docs/architecture.md` 文件中找到。

## 最近更新

我们最近进行了代码审查，引入了多项改进：

1. **增强错误处理**：在关键组件中添加了全面的异常处理机制
2. **改进日志记录**：更详细的日志信息，便于调试问题
3. **微信适配增强**：自适应UI元素识别算法，支持多种ID模式
4. **脚本引擎改进**：更好的脚本错误报告，包括行号和上下文
5. **数据库稳定性**：添加了数据库初始化和访问的错误恢复机制

## 贡献指南

欢迎通过以下方式贡献：

1. 报告问题
2. 提交功能请求
3. 提交代码改进
4. 改进文档

## 免责声明

本应用仅供学习和研究使用，请勿用于非法用途。使用本应用可能违反微信服务条款，请自行承担风险。

## 许可证

本项目采用MIT许可证 - 详见LICENSE文件 